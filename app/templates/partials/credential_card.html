{# Single credential card partial #}
{# Expects: acdc (dict with d, i, s, type, a, e, status) #}

{% set cred_type = acdc.type or 'UNKNOWN' %}
{% set status = acdc.status or 'UNKNOWN' %}
{% set is_valid = status == 'ACTIVE' or status == 'VALID' %}
{% set is_invalid = status == 'REVOKED' or status == 'INVALID' %}

<article class="credential-card {% if is_valid %}valid{% elif is_invalid %}invalid{% else %}unknown{% endif %}">
    <header style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:0.5rem;">
        <span>
            {# Credential type badge #}
            {% if cred_type == 'ROOT' %}
            <span class="badge badge-root">ROOT</span>
            {% elif cred_type == 'ISSUER' %}
            <span class="badge badge-issuer">ISSUER</span>
            {% elif cred_type == 'LE' %}
            <span class="badge badge-le">LE</span>
            {% elif cred_type == 'APE' %}
            <span class="badge badge-ape">APE</span>
            {% elif cred_type == 'DE' %}
            <span class="badge badge-de">DE</span>
            {% elif cred_type == 'TNAlloc' %}
            <span class="badge badge-tnalloc">TNAlloc</span>
            {% else %}
            <span class="badge badge-muted">{{ cred_type }}</span>
            {% endif %}

            {# Display name or SAID #}
            {% if acdc.displayName %}
            <strong>{{ acdc.displayName }}</strong>
            {% else %}
            <strong>{{ acdc.d[:16] }}...</strong>
            {% endif %}
        </span>

        {# Status badge #}
        {% if status == 'ACTIVE' or status == 'VALID' %}
        <span class="badge badge-success">{{ status }}</span>
        {% elif status == 'REVOKED' %}
        <span class="badge badge-danger">REVOKED</span>
        {% elif status == 'UNKNOWN' %}
        <span class="badge badge-warning">UNKNOWN</span>
        {% else %}
        <span class="badge badge-muted">{{ status }}</span>
        {% endif %}
    </header>

    <dl>
        <dt>SAID</dt>
        <dd><code style="font-size:0.8em;word-break:break-all;">{{ acdc.d }}</code></dd>

        {% if acdc.i %}
        <dt>Issuer AID</dt>
        <dd><code style="font-size:0.8em;word-break:break-all;">{{ acdc.i }}</code></dd>
        {% endif %}

        {% if acdc.s %}
        <dt>Schema SAID</dt>
        <dd><code style="font-size:0.8em;">{{ acdc.s[:24] }}...</code></dd>
        {% endif %}
    </dl>

    {# Attributes section #}
    {% if acdc.a and acdc.a is mapping %}
    <details>
        <summary>Attributes</summary>
        {% if acdc.a.vcard %}
        <h5>vCard</h5>
        <ul>
            {% for line in acdc.a.vcard %}
            <li><code>{{ line }}</code></li>
            {% endfor %}
        </ul>
        {% endif %}

        {% if acdc.a.legalName %}
        <p><strong>Legal Name:</strong> {{ acdc.a.legalName }}</p>
        {% endif %}

        {% if acdc.a.LEI or acdc.a.lids %}
        <p><strong>LEI:</strong> {{ acdc.a.LEI or acdc.a.lids[0] }}</p>
        {% endif %}

        {% if acdc.a.tn %}
        <p><strong>Telephone Numbers:</strong>
            {% if acdc.a.tn is string %}
                {{ acdc.a.tn }}
            {% else %}
                {{ acdc.a.tn | join(', ') }}
            {% endif %}
        </p>
        {% endif %}

        <details>
            <summary>Raw Attributes</summary>
            <div class="code-block">{{ acdc.a | tojson(indent=2) }}</div>
        </details>
    </details>
    {% endif %}

    {# Edges section #}
    {% if acdc.e and acdc.e is mapping and acdc.e.keys() | list | length > 0 %}
    <details>
        <summary>Edges (Links to other credentials)</summary>
        <ul>
        {% for key, edge in acdc.e.items() %}
            {% if edge is mapping and edge.n %}
            <li><strong>{{ key }}:</strong> <code style="font-size:0.8em;">{{ edge.n[:24] }}...</code></li>
            {% endif %}
        {% endfor %}
        </ul>
    </details>
    {% endif %}
</article>
